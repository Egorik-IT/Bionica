"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[53575],{720357:(e,t,r)=>{r.d(t,{ExternalEvents:()=>s});class s{dispose(){}constructor(){this.listeners=[],this.send=(e,t)=>{for(const r of this.listeners)r(e,t)},this.subscribe=e=>(this.listeners.push(e),()=>{this.listeners=this.listeners.filter((t=>t!==e))})}}},817882:(e,t,r)=>{function s(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M16.87 2c1.79 0 2.43.19 3.08.53.66.35 1.17.86 1.52 1.52s.53 1.3.53 3.08v9.74c0 1.79-.19 2.43-.53 3.08a3.63 3.63 0 0 1-1.52 1.52c-.65.34-1.3.53-3.08.53H7.13c-1.79 0-2.43-.19-3.08-.53s-1.17-.86-1.52-1.52C2.2 19.3 2 18.65 2 16.87V7.13c0-1.79.19-2.43.53-3.08.35-.66.86-1.17 1.52-1.52C4.7 2.2 5.35 2 7.13 2zm.57 2H6.56c-.89 0-1.21.1-1.54.27-.32.17-.58.43-.75.75-.18.33-.27.65-.27 1.54v10.88c0 .89.1 1.21.27 1.54.17.32.43.58.75.75.33.18.65.27 1.54.27h10.88c.89 0 1.21-.1 1.54-.27.32-.17.58-.43.75-.75.18-.33.27-.65.27-1.54V6.56c0-.89-.1-1.21-.27-1.54a1.82 1.82 0 0 0-.75-.75c-.33-.18-.65-.27-1.54-.27z" fill="currentColor"/></svg>',name:"check_box_off_24"}}r.d(t,{getIcon24CheckBoxOff:()=>s})},895798:(e,t,r)=>{function s(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M2.44 4.18C2 5.04 2 6.16 2 8.4v7.2c0 2.24 0 3.36.44 4.22a4 4 0 0 0 1.74 1.74c.86.44 1.98.44 4.22.44h7.2c2.24 0 3.36 0 4.22-.44a4 4 0 0 0 1.74-1.74c.44-.86.44-1.98.44-4.22V8.4c0-2.24 0-3.36-.44-4.22a4 4 0 0 0-1.74-1.74C18.96 2 17.84 2 15.6 2H8.4c-2.24 0-3.36 0-4.22.44a4 4 0 0 0-1.74 1.74zM18.2 9.21a1 1 0 0 0-1.42-1.42L10 14.6l-2.8-2.8a1 1 0 0 0-1.4 1.42l3.5 3.5a1 1 0 0 0 1.4 0z" fill="currentColor" fill-rule="evenodd"/></svg>',name:"check_box_on_24"}}r.d(t,{getIcon24CheckBoxOn:()=>s})},265658:(e,t,r)=>{r.d(t,{VKWebAppCustomMessage:()=>u});var s=r(939659),a=r(298077),i=r(290788),n=r(565703),o=r(788544),c=r(105330),d=r(540462),l=r(52905),p=r(837207);window.VKWebAppCustomMessageExternalHandlers=window.VKWebAppCustomMessageExternalHandlers??{};const h=(0,o.getMessengerSharedState)().externalEvents;class u extends i.Handler{actionHandler(e){if(e.action&&e.payload){if(this.app.isTextliveApp){const t=window.Textlives?.onBridgeEvent(e);return void(t&&t.then(this.successHandler).catch(this.errorHandler))}if(this.app.appId===l.NFT_APP_ID)return this.handleSetNftAvatar(e),void this.successHandler({result:!0});if(this.app.appId===l.ORD_APP_ID)return this.handleSetOrdData(e),void this.successHandler({result:!0},(()=>{if((0,d.partConfigEnabled)("messages_enable_vk_web_app_custom_message_processing"))try{h.send(this.params.handlerName,e)}catch(e){console.error(e)}}));if(this.app.appId===l.VMOJI_CONSTRUCTOR_APP_ID)return this.handleOpenStickerPicker(e),void this.successHandler({result:!0});if(this.app.appId===l.OZON_APP_ID&&window.cur?.handleOzonAppCustomMessage&&"function"==typeof window.cur.handleOzonAppCustomMessage)return window.cur.handleOzonAppCustomMessage(e),void this.successHandler({result:!0});if(this.app.appId===l.ONE_TIME_DONUT_APP_ID){try{this.handleWithExternalHandlers(e)}catch(e){(0,a.logError)(e)}return void this.successHandler({result:!0})}}this.errorHandler("unknown error")}handleSetNftAvatar({action:e,payload:t}){"VKWebAppSetNFTAvatar"===e&&((0,c.isMvk)()?window.OwnerPhotoUpload2.setNftAvatar(t):window.ajax.post("al_page.php",{act:"owner_avatar_upload",oid:t?.oid},{onDone:(e,r)=>{window.handleVKBridgeSetNftAvatar(t,e,r)}}))}handleOpenStickerPicker({action:e,payload:t}){if("vmoji_character_recereate"!==e)return;const{promo:r,page:a}=t;r&&(0,n.isNewStickerPicker)()&&!(0,c.isMvk)()&&(window.StickerPickerViewer?.showLastPicker(s.ServicePackKey.VMOJI),a?.match("/preview")||window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{window.Vmoji.showAddedToStickerSnackbar()})))}handleSetOrdData({action:e,payload:t}){"ord_data"===e&&t&&(0,p.getStore)().onOrdData({is_ad:t.isAd||!1,ord_pred_id:t.predId||"",erid:t.erId||""})}handleWithExternalHandlers(e){window.VKWebAppCustomMessageExternalHandlers[e.action]?.(e.payload)}constructor(e){super(e),this.params.handlerName="VKWebAppCustomMessage"}}},234430:(e,t,r)=>{r.d(t,{CLOSE_BUTTON_MODES:()=>_,UIAction:()=>S,renderCounter:()=>k,setCounter:()=>g});var s=r(105330),a=r(453736),i=r(150585),n=r(950189),o=r(801746),c=r(680208),d=r(936492),l=r(895798),p=r(817882),h=r(540462),u=r(670053);const _={INNER:0,OUTER:1},m="success",E="deny",R="extra",k=e=>{const t=document.createElement("span");return t.classList.add("VkAppModal__buttonCounter"),t.innerText=e,t},g=(e,t)=>{const r=e.find((e=>e.hasCounter));r&&r.counterElement&&(r.counterElement.innerText=t)};class S{addScroll(){(0,a.addPopupScroll)(this.modal.children[0],this.modalParentLayer)}init(){this.containerNode&&this.containerNode.appendChild(this.modal),this.modalParentLayer=this.modal.closest(".layer_wrap"),!1!==this.props.withScroll&&(this.modalParentLayer?this.modalParentLayer.addEventListener("scroll",this.addScroll):window.addEventListener("scroll",this.addScroll))}show(){(0,s.isMvk)()&&document.body.classList.add("vk_app_fixed"),this.props.withoutAnimation?this.modal.classList.add("show"):setTimeout((()=>this.modal.classList.add("show")),300),this.initMvkCloseActions(),this.addScroll()}initMvkCloseActions(){(0,s.isMvk)()&&(window.DirectGames&&(0,u.getCurrentApp)().isDirectGame&&window.DirectGames.onBoxOpen(this),this.props.onlyButtonHide||(this.modal.onclick=e=>{e.target===this.modal&&this.onAction(this.props.cancelAction)}))}close(){this.props.onlyButtonHide||this.onAction(this.props.cancelAction)}destroy(){if(!1!==this.props.withScroll&&(window.removeEventListener("scroll",this.addScroll),this.modalParentLayer&&this.modalParentLayer.removeEventListener("scroll",this.addScroll)),!this._destroyed){if((0,s.isMvk)()){document.body.classList.remove("vk_app_fixed");const e=(0,u.getCurrentApp)();window.DirectGames&&e.isDirectGame&&(window.DirectGames.onBoxClose(this),e.frame.focus())}this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback(),this._destroyed=!0}}_disableButton(e,t=!0){e.disabled=t,e.element.disabled=t}_lockButton(e,t=!0){const r=(0,s.isMvk)()?(0,n.getIcon24Spinner)().icon:(0,o.getIcon16Spinner)().icon,a=`\n    <span class="vk_app_modal_btn__content">${e.title}</span>\n    <span class="vk_app_modal_btn__spinner">${r}</span>\n    `;e.loading=t,e.element.innerHTML=t?a:e.title,e.element.classList.toggle("vk_app_modal_btn--loading",t)}async onAction(e){await e(),this.destroy()}lockButtons(e=!0){const t={[m]:this._lockButton,[E]:this._disableButton,[R]:this._disableButton};this.props.buttons.forEach((r=>t[r.type](r,e)))}_setCounter(e){g(this.props.buttons,e)}_renderBtn(e){const t=document.createElement("button");if(t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add(`vk_app_modal_btn--${e.type}`),t.innerText=e.title,t.addEventListener("click",(()=>e.type===R?e.action():this.onAction(e.action))),e.hasCounter){const r=k(0);t.appendChild(r),e.counterElement=r}return e.element=t,e.disabled&&this._disableButton(e),e.loading&&this._lockButton(e),t}_renderBtns(e){const t=e.querySelector(".vk_app_modal_btns"),{buttons:r}=this.props;if(t){r.forEach((e=>t.appendChild(this._renderBtn(e))));const e=r.find((e=>e.type===R));1===r.length&&t.classList.add("vk_app_modal_btns--single-btn"),e&&t.classList.add("vk_app_modal_btns--hasExtraButton")}}_renderCloseBtn(e){const t=document.createElement("button");t.setAttribute("type","button"),t.classList.add("vk_app_modal_close_btn"),(0,s.isMvk)()||this.props.closeButtonMode!==_.OUTER?t.innerHTML=(0,d.getIcon24Cancel)().icon:(t.classList.add("vk_app_modal_close_btn--outer"),t.innerHTML=(0,c.getIcon20Cancel)().icon),t.addEventListener("click",(()=>this.onAction(this.props.cancelAction))),e.children[0].appendChild(t)}_renderCheckboxFields(e,t){const r=document.createElement("div");r.classList.add("MiniAppsCheckbox__fields");const s=document.createElement("h5");if(s.classList.add("MiniAppsCheckbox__fields-title"),s.innerHTML=e,r.appendChild(s),t){const e=document.createElement("h6");e.classList.add("MiniAppsCheckbox__fields-description"),e.innerHTML=t,r.appendChild(e)}return r}_renderCheckbox(e){const{title:t,description:r,...a}=e,i=document.createElement("label");i.classList.add("MiniAppsCheckbox");const n=document.createElement("input");if(n.type="checkbox",n.classList.add("MiniAppsCheckbox__checkbox"),n.addEventListener("change",(t=>e.checked=t.target.checked)),i.appendChild(n),Object.entries(a).forEach((([e,t])=>{n[e]=t})),(0,s.isMvk)()){const e=document.createElement("div");e.classList.add("MiniAppsCheckbox__fake_checkbox","MiniAppsCheckbox__fake_checkbox--checked"),e.innerHTML=(0,l.getIcon24CheckBoxOn)().icon,i.appendChild(e);const t=document.createElement("div");t.classList.add("MiniAppsCheckbox__fake_checkbox","MiniAppsCheckbox__fake_checkbox--unchecked"),t.innerHTML=(0,p.getIcon24CheckBoxOff)().icon,i.appendChild(t)}else{const e=document.createElement("div");e.classList.add("MiniAppsCheckbox__fake_checkbox"),i.appendChild(e)}const o=this._renderCheckboxFields(t,r);return i.appendChild(o),i}_renderCheckboxWrap(e){const t=e.querySelector(".MiniAppsModalCheckbox");t&&this.props.checkbox.map((e=>t.appendChild(this._renderCheckbox(e))))}_renderOuter(){const e=document.createElement("div");return e.classList.add("vk_app_modal_outer"),e}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach(((e,t)=>{e.type===E?this.props.buttons[t].action=this.props.cancelAction:e.type===R?this.props.buttons[t].action=this.props.extraAction:this.props.buttons[t].action=this.props.allowAction}))}_renderScopes(e){return e.map(((e,t)=>{const r=getLang(`vkapps_scope_${e}`);return 0===t?r:r.toLowerCase()})).join(", ")}prepareScopes(e){return 0===e.length?["general"]:e}prepareExtraBtn(){const e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("vk_app_modal_btn","VkAppModal__button--extra","vk_app_modal_btn--transparent"),e.innerHTML=getLang("apps_connect_modal_messages_scopes_edit"),e.addEventListener("click",this.props.extraAction),e}getThumb(){if(this.props.svgIcon)return this.props.svgIcon;const e=this.props.picClass?this.props.picClass:"";return this.props.pic?`<img src="${this.props.pic}" class="vk_app_modal_container__pic MiniAppModalContainer__pic ${e}" alt aria-label="product">`:""}isHorizontalLayoutSupported(){return(0,s.isMvk)()&&(0,h.partConfigEnabled)("vk_bridge_modals_horizontal_layout")}renderModal(){this.props.containerClass=this.props.containerClass||"",this.props.buttonsClass=this.props.buttonsClass||"",this.props.isGradientModal&&(0,s.isMvk)()&&(this.props.containerClass+=" MiniAppsGradientModal"),this.props.isNoWrapButtons&&(0,s.isMvk)()&&(this.props.buttonsClass+=" MiniAppsNoWrapButtons");const e=this.props.scopes&&this.props.scopes.length&&this.props.extraAction;this.isHorizontalLayoutSupported()&&(this.props.containerClass+=" VkAppModal__Container--horizontalSupport",e&&(this.props.containerClass+=" VkAppModal__Container--withExtraButton"));let t=`\n    <div class="vk_app_modal_container vk_app_modal_container--flex ${this.props.containerClass||""}">\n      <div class="vk_app_modal_content">\n        ${this.getThumb()}\n        <h2 class="vk_app_modal_container__heading">${this.props.title}</h2>\n        ${this._renderSubheading()}\n        ${this._renderTextSeparator()}\n        ${this._renderText(this.props.text)}\n      `;this.props.scopes&&(t+=`\n          <p class="vk_app_modal_container__text">${getLang("apps_connect_modal_messages_scopes_text")}</p>\n          <p class="vk_app_modal_container__list">${this._renderScopes(this.prepareScopes(this.props.scopes))}.</p>`),t+=`\n          </div>\n          ${this.props.checkbox?'<div class="MiniAppsModalCheckbox"></div>':""}\n          <div class="vk_app_modal_btns ${this.props.buttonsClass}"></div>\n      </div>`,this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=t,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),e&&this.modal.getElementsByClassName("vk_app_modal_content")[0].appendChild(this.prepareExtraBtn()),this._renderBtns(this.modal),this.props.checkbox&&this._renderCheckboxWrap(this.modal),this.props.scopes&&this._setCounter(this.props.scopes.length)}_renderText(e){if(!e)return"";return(Array.isArray(e)?e:[e]).map((e=>`<p class="vk_app_modal_container__text">${e}</p>`)).join("")}_renderSubheading(){return this.props.subheading?`<h3 class="vk_app_modal_container__subheading">${this.props.subheading}</h3>`:""}_renderTextSeparator(){return this.props.isTextSeparated?'<div class="vk_app_modal_container__text_separator"></div>':""}constructor(e,t){this.props={...e},t&&(this.callback=t),this.props.buttons=this.props.buttons||[],this.containerNode=document.getElementById(this.props.containerId),this.modal=null,this.modalParentLayer=null,this.onAction=this.onAction.bind(this),this.addScroll=(0,i.throttle)(this.addScroll.bind(this),a.THROTTLE_TIME),this.renderModal(),this._destroyed=!1}}},453736:(e,t,r)=>{r.d(t,{THROTTLE_TIME:()=>i,addPopupScroll:()=>n});var s=r(105330),a=r(670053);const i=300,n=(e,t)=>{const r=t?t.scrollTop:window.pageYOffset,i=(0,a.getCurrentApp)();if(i&&!(0,s.isMvk)()){const t=50*(Boolean(window.vk?.rtl)?1:-1),s=i.frame.clientHeight-360,a=Math.max(103,Math.min(r,s)+102);requestAnimationFrame((function(){e.style.transform=`translateX(${t}%) translateY(${a}px)`}))}}},520637:(e,t,r)=>{r.d(t,{default:()=>a});var s=r(52905);const a=class{_errorStrucuture(e,t){let r={type:this.method,data:{error_type:this.type,error_data:{error_code:e}}};return this.type===s.ERROR_TYPES.API?(r.data.error_data.error_msg=t,this.data.request_params&&(r.data.error_data.request_params=this.data.request_params)):r.data.error_data.error_reason=t,this.data.request_id&&(r.data.request_id=this.data.request_id),this.data.description&&(r.data.error_data.error_description=this.data.description),r}getReadableMessage(){const{error_reason:e,error_msg:t,error_description:r}=this.selectErrorType().data.error_data;return e||t||r}selectErrorType(){if(!this.data.hasOwnProperty("code"))return this.data.hasOwnProperty("error_code")?this._errorStrucuture(this.data.error_code,this.data.error_msg||s.ERROR_REASONS.UNKNOWN_ERROR):this.data.error_msg&&"operation denied by user"===this.data.error_msg.toLowerCase()?this._errorStrucuture(s.ERROR_CODES.USER_DENIED,"User denied"):this._errorStrucuture(s.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||s.ERROR_REASONS.UNKNOWN_ERROR);switch(this.data.code){case s.ERROR_CODES.MISSING_PARAM:return this._errorStrucuture(s.ERROR_CODES.MISSING_PARAM,this.data.reason||"Missing required params or wrong type of param");case s.ERROR_CODES.CONNECTION_LOST:return this._errorStrucuture(s.ERROR_CODES.CONNECTION_LOST,this.data.reason||s.ERROR_REASONS.CONNECTION_LOST);case s.ERROR_CODES.USER_DENIED:return this._errorStrucuture(s.ERROR_CODES.USER_DENIED,this.data.reason||s.ERROR_REASONS.USER_DENIED);case s.ERROR_CODES.INVALID_PARAMS:return this._errorStrucuture(s.ERROR_CODES.INVALID_PARAMS,this.data.reason||s.ERROR_REASONS.INVALID_PARAMS);case s.ERROR_CODES.ACCESS_DENIED:return this._errorStrucuture(s.ERROR_CODES.ACCESS_DENIED,this.data.reason||s.ERROR_REASONS.ACCESS_DENIED);case s.ERROR_CODES.CUSTOM:return this._errorStrucuture(s.ERROR_CODES.CUSTOM,this.data.reason||this.data.error_msg);case s.ERROR_CODES.REQUESTS_LIMIT_REACHED:return this._errorStrucuture(s.ERROR_CODES.REQUESTS_LIMIT_REACHED,"Requests limit reached");case s.ERROR_CODES.UNKNOWN:return this._errorStrucuture(s.ERROR_CODES.UNKNOWN,s.ERROR_REASONS.UNKNOWN_ERROR);default:return this._errorStrucuture(this.data.code?this.data.code:s.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||s.ERROR_REASONS.UNKNOWN_ERROR)}}constructor(e,t,r=s.ERROR_TYPES.CLIENT){this.data=t||{},this.method=e,this.type=r}}},494565:(e,t,r)=>{r.d(t,{destroyOpenedApp:()=>n,filterPostMessageOrigin:()=>c,getHostName:()=>i,isAllowedPostMessageOriginHost:()=>d,isVKPayApp:()=>o,objectToQuerystring:()=>a});var s=r(52905);const a=(e,t="?",r=!1)=>Object.keys(e).reduce(((s,a,i)=>[s,0===i?t:"&",encodeURIComponent(a),"=",r&&Array.isArray(e[a])?e[a].map(encodeURIComponent).join(","):encodeURIComponent(e[a])].join("")),""),i=e=>{const t=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=t&&t.length>2&&"string"==typeof t[2]&&t[2].length>0?t[2].toLowerCase():null},n=e=>{if(cur.vkAppQueue){const t=Object.keys(cur.vkAppQueue).filter((t=>~t.indexOf(e)));if(t.length>0){const e=t[0];cur.vkAppQueue[e].destroyView(),delete cur.vkAppQueue[e]}}},o=e=>s.VKPAY_APPS.includes(e);function c(e,t){const r=i(t),s=e.vkApp?e.vk_app_url:e.src,a=i(s);if(r!==a&&!d(e,r))throw Error(`Insecure method call from ${r}. Call must be from ${a}`);return!0}function d(e,t){if(!e.allowed_origin_regexp)return!1;return new RegExp(e.allowed_origin_regexp).test(t)}},290788:(e,t,r)=>{r.d(t,{Handler:()=>u});var s=r(914421),a=r(520637),i=r(234430),n=r(52905),o=r(105330),c=r(898848),d=r(314309),l=r(695368),p=r(540462),h=r(670053);class u{get successDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Result`}get errorDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Failed`}get previousCallsCount(){return this.app?.context?.getHandlerCallsCount(this.params.handlerName)-1||0}shouldLogStat(){return!0}shouldLogCallArgumentsInStat(){return(0,p.partConfigEnabled)("mini_apps_send_stat_arguments_bridge_events")&&Array.isArray(this.app?.bridgeMethodsToBeLogged)&&this.app.bridgeMethodsToBeLogged.includes(this.params.handlerName)}getEventHash(e=!1){const t=`${this.getEventName(e)}_hash`;return(0,h.getCurrentApp)()?.options[t]}getEventName(e=!1){const t=`${this.params.handlerName}${e?"Preload":""}`;return n.VK_CONNECT_EVENTS[t]}sendNetworkError(){this.errorHandler({code:n.ERROR_CODES.UNKNOWN,error_type:n.ERROR_TYPES.CLIENT,reason:n.ERROR_REASONS.UNKNOWN_ERROR})}sendConnectionLostError(){this.errorHandler({code:n.ERROR_CODES.CONNECTION_LOST,error_type:n.ERROR_TYPES.CLIENT,reason:n.ERROR_REASONS.CONNECTION_LOST})}sendUserDeniedError(){this.errorHandler({code:n.ERROR_CODES.USER_DENIED,error_type:n.ERROR_TYPES.CLIENT,reason:n.ERROR_REASONS.USER_DENIED})}handleApiError(e){const t=e?.error,r=t?.error_msg,s=t?.error_code;if(s)switch(s){case l.API_ERROR_ACCESS:this.errorHandler({code:n.ERROR_CODES.ACCESS_DENIED,error_type:n.ERROR_TYPES.CLIENT,reason:r});break;case l.API_ERROR_PARAM:this.errorHandler({code:n.ERROR_CODES.INVALID_PARAMS,error_type:n.ERROR_TYPES.CLIENT,reason:r});break;default:this.errorHandler({code:n.ERROR_CODES.CUSTOM,error_type:n.ERROR_TYPES.CLIENT,reason:r||n.ERROR_REASONS.UNKNOWN_ERROR})}else this.errorHandler({code:n.ERROR_CODES.CONNECTION_LOST,error_type:n.ERROR_TYPES.CLIENT,reason:r||n.ERROR_REASONS.UNKNOWN_ERROR})}sendCustomError(e){this.errorHandler({code:n.ERROR_CODES.CUSTOM,reason:e||n.ERROR_REASONS.UNKNOWN_ERROR})}checkParams(e,t){for(let r=0;r<t.length;r++){const{param:s,type:a,isRequired:i,extraChecks:o}=t[r];if(!e.hasOwnProperty(s)&&i)return this.errorHandler({code:n.ERROR_CODES.MISSING_PARAM,reason:`Missing required param "${s}"`}),!1;if(e.hasOwnProperty(s)&&typeof e[s]!==a)return this.errorHandler({code:n.ERROR_CODES.INVALID_PARAMS,reason:`Param "${s}" should be ${a}`},this.callback),!1;if(e.hasOwnProperty(s)&&o&&o.length>0)for(let t=0;t<o.length;t++)if(!o[t].check(e[s]))return this.errorHandler({code:n.ERROR_CODES.INVALID_PARAMS,reason:o[t].error(s)},this.callback),!1}return!0}actionHandler(e){return this.callApi?window.ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,...e},{onDone:t=>{this.handleResponse(t,e,this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)}):{}}checkResponse(e){1===e||0===e?this.successHandler(Boolean(e)):this.successHandler(e)}scopeStringToArray(e){return e?e.replace(/ /g,"").split(","):[]}denyUIAction(e){this.errorHandler({error_type:"client_error",code:n.ERROR_CODES.USER_DENIED},null),this.modal&&s.default.pop(this.modal)}allowUIAction(e){this.actionHandler(e),this.modal&&s.default.pop(this.modal)}createDenyUIAction(e){this.params.modal.cancelAction=void 0!==e?()=>this.denyUIAction(e):this.denyUIAction}createAllowUIAction(e){this.params.modal.allowAction=void 0!==e?()=>this.allowUIAction(e):this.allowUIAction}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new i.UIAction({...this.params.modal,...e}),s.default.push(this.modal)}_enhanceBtnsWithActions(){this.params.modal.buttons?.forEach((e=>{"deny"===e.type?e.action=this.params.modal.cancelAction:e.action=this.params.modal.allowAction}))}setData(e,t,r=null){r&&(this.callback=r),e.request_id&&(this.params.request_id=e.request_id),this.params.modal||(this.params.modal={}),e.containerId&&(this.params.modal.containerId=e.containerId),e.pic&&(this.params.modal.pic=e.pic),this.app=t,this.shouldLogCallArgumentsInStat()&&(this.callArguments=e)}handleResponse(e,t,r,s){try{const s=JSON.parse(e);s.hasOwnProperty("error")?this.errorHandler(s.error):r(s,t)}catch(e){s?s(e):this.errorHandler(e)}}handler(e,t,r){if(this.setData(e,t),this.callback=r,this.isWebOnly&&(0,o.isMvk)()||this.isMobileWebOnly&&!(0,o.isMvk)())return this.errorHandler({code:n.ERROR_CODES.UNSUPPORTED_PLATFORM,error_type:n.ERROR_TYPES.CLIENT,reason:n.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.useUI?this.launchUI(e):this.useUI||this.actionHandler(e)}getAppWebviewUrl(){return(0,h.getCurrentApp)()?.frame?.src||""}cleanCallArguments(e){const t=["request_id","handlerName","method","modal","containerId","pic"];for(const r of t)delete e[r];return e}getSerializedCallArguments(){if(!this.shouldLogCallArgumentsInStat()||!this.callArguments)return null;const e=this.cleanCallArguments({...this.callArguments});let t=JSON.stringify(e);return t.length>n.BRIDGE_STAT_CALL_ARGUMENTS_MAX_LENGTH&&(t=null),t}isPassedParameters(e){return(0,c.isObject)(e)}successHandler(e,t){if("function"==typeof t&&t(),this.isPassedParameters(e)||(e={result:e}),this.params.request_id&&(e.request_id=this.params.request_id),this.callback?.({type:this.successDescriptor,data:e},this.params.handlerName),(0,o.isMvk)()&&(0,h.getCurrentApp)()?.frame?.focus(),this.shouldLogStat()){const e=this.getSerializedCallArguments();d.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!0,...e?{call_arguments:e}:{}},void 0,this.app.vkApp.sessionUuid)}}errorHandler(e,t,r){"string"==typeof e&&(e={reason:e}),this.params.request_id&&e&&(e.request_id=this.params.request_id);const s=new a.default(this.errorDescriptor,e,r),i=s.selectErrorType();if("function"==typeof t&&t(i),this.callback?.(i),(0,o.isMvk)()&&(0,h.getCurrentApp)()?.frame?.focus(),this.shouldLogStat()){const e=this.getSerializedCallArguments();d.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!1,...e?{call_arguments:e}:{}},{error_type:s.type||n.ERROR_TYPES.CLIENT,error_code:s.data.code||n.ERROR_CODES.UNKNOWN},this.app.vkApp.sessionUuid,s.getReadableMessage())}}constructor(e={}){this.params={handlerName:"handler",method:"method",modal:{},...e},this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.isWebOnly=!1,this.isMobileWebOnly=!1,this.callArguments=null,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),this.checkResponse=this.checkResponse.bind(this),this.getSerializedCallArguments=this.getSerializedCallArguments.bind(this),window.cur.vkAppSuccessHandler=this.successHandler,window.cur.vkAppErrorHandler=this.errorHandler}}},310338:(e,t,r)=>{r.d(t,{VKWebAppCustomMessage:()=>s.VKWebAppCustomMessage,getStore:()=>a.getStore});var s=r(265658),a=r(837207)},837207:(e,t,r)=>{r.d(t,{getStore:()=>n});var s=r(558137),a=r(32489);function i(){return{onOrdData:(0,a.createDomain)("APPS_CONNECT/VKWebAppCustomMessage").createEvent()}}function n(){return(0,s.makeSharedState)("static/js/modules/shared/apps_connect/handlers/VKWebAppCustomMessage/store.ts",i,{version:0})()}},914421:(e,t,r)=>{r.d(t,{default:()=>a});var s=r(558137);const a=new class{initCallback(){window.cur=window.cur||{},window.cur.clearVKMiniAppsLayerPopups=this.clearLayerPopups.bind(this)}get vkMiniAppsStack(){return(0,s.makeSharedState)("MiniAppsModalsStack",(()=>[]),{version:0})()}get modalCount(){return this.vkMiniAppsStack.length}push(e){e.init(),0===this.modalCount&&e.show(),this.vkMiniAppsStack.push(e)}clearLayerPopups(){if(this.modalCount>0){const e=this.vkMiniAppsStack.filter((e=>"appNode"in e&&!e.appNode.id.includes("container_layer")));this.vkMiniAppsStack.splice(0,this.modalCount),this.vkMiniAppsStack.push(...e)}}pop(e){const t=this.vkMiniAppsStack.indexOf(e);-1!==t&&(this.vkMiniAppsStack.splice(t,1),this.checkForNext())}shift(){this.vkMiniAppsStack.shift(),this.checkForNext()}checkForNext(){this.modalCount>0&&this.vkMiniAppsStack[0].show()}constructor(){this.initCallback()}}},788544:(e,t,r)=>{r.d(t,{getMessengerSharedState:()=>s.getMessengerSharedState});var s=r(688337)},688337:(e,t,r)=>{r.d(t,{getMessengerSharedState:()=>a});var s=r(720357);const a=(0,r(558137).makeSharedState)("vkcom-messenger::web",(()=>({externalEvents:new s.ExternalEvents})),{version:0})},523901:(e,t,r)=>{r.d(t,{PackContext:()=>d});var s=r(434518),a=r(763812),i=(0,a._)("_options"),n=(0,a._)("_pack"),o=(0,a._)("_product"),c=(0,a._)("_stockItem");class d{get rawData(){return(0,s._)(this,n)[n]||(0,s._)(this,c)[c]||(0,s._)(this,o)[o]}get isPack(){return Boolean((0,s._)(this,n)[n])}get isProduct(){return Boolean((0,s._)(this,o)[o])}get isStockItem(){return Boolean((0,s._)(this,c)[c])}get isStoreItem(){return this.isProduct||this.isStockItem}get stockItem(){return(0,s._)(this,c)[c]}get id(){const e=(0,s._)(this,i)[i]?.redefine?.id;if(void 0!==e)return e;const t=(0,s._)(this,o)[o]?.id;return void 0!==t?t:(0,s._)(this,n)[n]?.id}setHint(e){return(0,s._)(this,i)[i]?((0,s._)(this,i)[i].hint=e,this):this}get hintId(){return(0,s._)(this,i)[i]?.hint?.id}get hintWidth(){return(0,s._)(this,i)[i]?.hint?.width}get index(){return(0,s._)(this,i)[i]?.index}get referrer(){return(0,s._)(this,i)[i]?.referrer}get tooltip(){return(0,s._)(this,i)[i]?.tooltip}get title(){return(0,s._)(this,i)[i]?.redefine?.title||(0,s._)(this,o)[o]?.title||""}get stickers(){return(0,s._)(this,i)[i]?.redefine?.stickers||(0,s._)(this,n)[n]?.stickers||(0,s._)(this,o)[o]?.stickers}get baseId(){return(0,s._)(this,o)[o]?.base_id}get isStyle(){return void 0!==this.baseId}get hasStyles(){return Boolean(this.styleIds?.length)}get styleIds(){return(0,s._)(this,o)[o]?.style_ids}get canGift(){return Boolean((0,s._)(this,c)[c]?.can_gift)}get vmojiAvatar(){return(0,s._)(this,o)[o]?.vmoji_avatar}get isVmoji(){return Boolean(this.vmojiAvatar||(0,s._)(this,o)[o]?.is_vmoji)}get isPopup(){return(0,s._)(this,o)[o]?.is_popup}get isNew(){return(0,s._)(this,o)[o]?.is_new}get previews(){return(0,s._)(this,o)[o]?.previews}constructor({pack:e,...t}){Object.defineProperty(this,i,{writable:!0,value:void 0}),Object.defineProperty(this,n,{writable:!0,value:void 0}),Object.defineProperty(this,o,{writable:!0,value:void 0}),Object.defineProperty(this,c,{writable:!0,value:void 0}),(0,s._)(this,i)[i]=t,e&&("product"in e?((0,s._)(this,c)[c]=e,(0,s._)(this,o)[o]=e.product):"id"in e&&"type"in e?(0,s._)(this,o)[o]=e:(0,s._)(this,n)[n]=e)}}},720112:(e,t,r)=>{r.d(t,{$favoriteStickers:()=>i,setFavoriteStickers:()=>a});var s=r(175325);const a=s.stickersEmojiKeyboard.createEvent(),i=s.stickersEmojiKeyboard.createStore(null).on(a,((e,t)=>t))},460543:(e,t,r)=>{r.d(t,{$hasAvatar:()=>i,setHasAvatar:()=>a});var s=r(175325);const a=s.stickersEmojiKeyboard.createEvent(),i=s.stickersEmojiKeyboard.createStore(null).on(a,((e,t)=>t))},939659:(e,t,r)=>{r.d(t,{$packs:()=>m,ServicePackKey:()=>s});var s,a,i=r(32489),n=r(270634),o=r(969102),c=r(853262),d=r(460543),l=r(432726),p=r(649179),h=r(409875),u=r(720112),_=r(523901);!function(e){e[e.FAVORITE=-1]="FAVORITE",e[e.RECENT=-2]="RECENT",e[e.VMOJI=-3]="VMOJI",e[e.UGC=-4]="UGC",e[e.PHOTO_EDITOR=-5]="PHOTO_EDITOR"}(s||(s={})),function(e){e.RECENT="recent",e.FAVORITE="favourite",e.KEYBOARD="keyboard"}(a||(a={}));const m=(0,i.combine)(o.$ugcInfo,c.$ugcPacks,l.$stockItems,p.$recentStickers,h.$photoEditorStickers,u.$favoriteStickers,d.$hasAvatar,((e,t,r,s,a,i,o)=>{const c=new Map;let d=[];const l=new Map;let p=0;if(!r||!s||!i||n.$context.getState()===n.CONTEXT.PHOTO_EDITOR&&!a)return{};a?.length&&(c.set(-5,new _.PackContext({index:p,referrer:"keyboard",redefine:{id:-5,stickers:a}})),d.push(-5),p++),i.length&&(c.set(-1,new _.PackContext({index:p,referrer:"favourite",redefine:{id:-1,title:"stickers_picker_favorite",stickers:i}})),d.push(-1),p++),s.length&&(c.set(-2,new _.PackContext({index:p,referrer:"recent",redefine:{id:-2,title:"stickers_picker_recently_used",stickers:s}})),d.push(-2),p++);-1!==r?.findIndex((({product:{vmoji_avatar:e}})=>void 0!==e))||o||(c.set(-3,new _.PackContext({index:p,referrer:"keyboard",redefine:{id:-3,title:"stickers_picker_vmoji"}})),d.push(-3),p++);const h=t?.[0],u=e?.can_edit,m=h?.stickers?.length,E=e?.show_keyboard_onboarding&&u;if(!e?.is_keyboard_hidden&&(m||E)){const e=new _.PackContext({pack:h,index:p,referrer:"keyboard",tooltip:{header:"stickers_picker_ugc_tooltip_title",text:"stickers_picker_ugc_tooltip_description"},redefine:{id:-4,title:"stickers_picker_ugc"}});u&&e.setHint({id:"stickers:ugc_keyboard_onboarding_tooltip",width:176}),c.set(-4,e),d.push(-4),p++}return r.forEach((e=>{const{product:{id:t,vmoji_avatar:r}}=e;if(c.set(t,new _.PackContext({index:p,referrer:"keyboard",pack:e})),r){let e=l.get(r.id);e||(e=d.push([])-1,l.set(r.id,e));const s=d[e];Array.isArray(s)&&s.push(t)}else d.push(t);p++})),{packs:c,packsGroups:d}}))},432726:(e,t,r)=>{r.d(t,{$stockItems:()=>i,setStockItems:()=>a});var s=r(175325);const a=s.stickersEmojiKeyboard.createEvent(),i=s.stickersEmojiKeyboard.createStore(null).on(a,((e,t)=>t))},409875:(e,t,r)=>{r.d(t,{$photoEditorStickers:()=>i,setPhotoEditorStickers:()=>a});var s=r(175325);const a=s.stickersEmojiKeyboard.createEvent(),i=s.stickersEmojiKeyboard.createStore(null).on(a,((e,t)=>t))},649179:(e,t,r)=>{r.d(t,{$recentStickers:()=>i,setRecentStickers:()=>a});var s=r(175325);const a=s.stickersEmojiKeyboard.createEvent(),i=s.stickersEmojiKeyboard.createStore(null).on(a,((e,t)=>t))},969102:(e,t,r)=>{r.d(t,{$ugcInfo:()=>l,reloadUGCInfo:()=>c,setUGCInfo:()=>o});var s=r(32489),a=r(348385),i=r(175325),n=r(579924);const o=i.stickersEmojiKeyboard.createEvent(),c=i.stickersEmojiKeyboard.createEvent(),d=i.stickersEmojiKeyboard.createEffect((e=>e.cache.ugcInfo.get().catch((()=>null)))),l=i.stickersEmojiKeyboard.createStore(null).on(o,((e,t)=>t)).on(d.doneData,((e,t)=>t)).on(n.submitUGCReportFx.doneData,(()=>null));(0,s.sample)({clock:c,source:a.$api,target:d})},853262:(e,t,r)=>{r.d(t,{$ugcPacks:()=>n,setUGCPacks:()=>i});var s=r(175325),a=r(579924);const i=s.stickersEmojiKeyboard.createEvent(),n=s.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t)).on(a.submitUGCReportFx.doneData,(()=>null))},579924:(e,t,r)=>{r.d(t,{submitUGCReport:()=>n,submitUGCReportFx:()=>o});var s=r(32489),a=r(348385),i=r(175325);const n=i.stickersEmojiKeyboard.createEvent(),o=i.stickersEmojiKeyboard.createEffect((e=>{e.cache.clearUGC()}));(0,s.sample)({clock:n,source:a.$api,target:o})},156006:(e,t,r)=>{r.d(t,{Icon12Stars:()=>s});var s=(0,r(844990).makeIcon)("Icon12Stars","stars_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="stars_12"><path d="M2.803.218a.319.319 0 0 0-.606 0l-.242.728c-.159.476-.533.85-1.009 1.009l-.728.242a.319.319 0 0 0 0 .606l.728.242c.476.159.85.533 1.009 1.009l.242.728a.32.32 0 0 0 .606 0l.242-.728c.159-.476.533-.85 1.009-1.009l.728-.242a.319.319 0 0 0 0-.606l-.728-.242A1.6 1.6 0 0 1 3.045.946zm3.633 3.254c-.256.746-.599 1.5-1.031 1.933-.433.432-1.187.775-1.933 1.03a12 12 0 0 1-.768.237c-.272.075-.272.58 0 .656a15 15 0 0 1 .768.236c.746.256 1.5.599 1.933 1.031.432.433.775 1.187 1.03 1.933a13 13 0 0 1 .237.768c.075.272.58.272.656 0a15 15 0 0 1 .236-.768c.256-.746.599-1.5 1.031-1.933.433-.432 1.187-.775 1.933-1.03a13 13 0 0 1 .768-.237c.272-.075.272-.58 0-.656a15 15 0 0 1-.768-.236c-.746-.256-1.5-.599-1.933-1.031-.432-.433-.775-1.187-1.03-1.933a12 12 0 0 1-.237-.768c-.075-.272-.58-.272-.656 0a15 15 0 0 1-.236.768" clip-rule="evenodd" /></symbol>',12,12,!1,void 0)},289150:(e,t,r)=>{r.d(t,{Icon20DownloadOutline:()=>s});var s=(0,r(844990).makeIcon)("Icon20DownloadOutline","download_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="download_outline_20"><g fill="currentColor"><path fill-rule="evenodd" d="M4 17.75a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H4.75a.75.75 0 0 1-.75-.75" clip-rule="evenodd" /><path d="M10.75 2.726c0-.401-.336-.726-.75-.726a.74.74 0 0 0-.75.726v9.722l-3.97-3.97a.75.75 0 0 0-1.06 1.06l5.245 5.246a.75.75 0 0 0 1.06 0l5.257-5.256a.75.75 0 0 0-1.061-1.061l-3.972 3.972z" /></g></symbol>',20,20,!1,void 0)},739483:(e,t,r)=>{r.d(t,{Icon20LinkCircleOutline:()=>s});var s=(0,r(844990).makeIcon)("Icon20LinkCircleOutline","link_circle_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="link_circle_outline_20"><g fill="currentColor"><path d="M7 7.75c0 .414.336.75.75.75h2.69l-3.22 3.22a.75.75 0 1 0 1.06 1.06l3.22-3.22v2.69a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0-.75.75" /><path fill-rule="evenodd" d="M10 18.5a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17m7-8.5a7 7 0 1 1-14 0 7 7 0 0 1 14 0" clip-rule="evenodd" /></g></symbol>',20,20,!1,void 0)},709781:(e,t,r)=>{r.d(t,{Icon28ShareOutline:()=>s});var s=(0,r(844990).makeIcon)("Icon28ShareOutline","share_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="share_outline_28"><path fill="currentColor" fill-rule="evenodd" d="M13.476 6.513c0-.442.485-.651.797-.406l9.532 7.483a.52.52 0 0 1 0 .812l-9.532 7.484a.495.495 0 0 1-.797-.406v-4.485a1 1 0 0 0-1-1c-3.565 0-6.252 1.449-8.26 3.267.362-2.161 1.153-3.807 2.225-5.046 1.497-1.73 3.637-2.78 6.22-3.264a1 1 0 0 0 .815-.983zm2.032-1.979c-1.654-1.298-4.032-.093-4.032 1.979V9.16c-2.565.61-4.854 1.79-6.548 3.749C3.051 15.079 2 18.093 2 22.05a1 1 0 0 0 1.788.616c1.741-2.226 4.175-4.292 7.688-4.625v3.438c0 2.072 2.378 3.277 4.032 1.978l9.532-7.483a2.518 2.518 0 0 0 0-3.957z" clip-rule="evenodd" /></symbol>',28,28,!1,void 0)},570551:(e,t,r)=>{function s(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}r.d(t,{default:()=>s})},479672:(e,t,r)=>{r.d(t,{default:()=>i});var s=r(10123),a=r(570551);function i(e,t){(0,a.default)(2,arguments);var r=(0,s.default)(e),i=(0,s.default)(t);return r.getTime()>i.getTime()}},27813:(e,t,r)=>{r.d(t,{default:()=>i});var s=r(10123),a=r(570551);function i(e,t){(0,a.default)(2,arguments);var r=(0,s.default)(e),i=(0,s.default)(t);return r.getTime()<i.getTime()}},10123:(e,t,r)=>{r.d(t,{default:()=>i});var s=r(282284),a=r(570551);function i(e){(0,a.default)(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===(0,s.default)(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}},282284:(e,t,r)=>{function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}r.d(t,{default:()=>s})}}]);try{stManager?.done("dist/web/chunks/84cdc0e3.4762d63a.js")}catch(e){}